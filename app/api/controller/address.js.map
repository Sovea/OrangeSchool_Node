{
    "version": 3,
    "sources": [
        "../../../src/api/controller/address.js"
    ],
    "names": [
        "Base",
        "require",
        "module",
        "exports",
        "listAction",
        "addressList",
        "model",
        "where",
        "user_id",
        "getLoginUserId",
        "select",
        "itemKey",
        "addressItem",
        "province_name",
        "getRegionName",
        "province_id",
        "city_name",
        "city_id",
        "district_name",
        "district_id",
        "full_region",
        "success",
        "detailAction",
        "addressId",
        "get",
        "addressInfo",
        "id",
        "find",
        "think",
        "isEmpty",
        "saveAction",
        "post",
        "addressData",
        "name",
        "mobile",
        "address",
        "is_default",
        "add",
        "update",
        "deleteAction",
        "delete"
    ],
    "mappings": "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",
    "file": "../../../src/api/controller/address.js",
    "sourcesContent": [
        "const Base = require('./base.js');\r\n\r\nmodule.exports = class extends Base {\r\n  /**\r\n   * 获取用户的收货地址\r\n   * @return {Promise} []\r\n   */\r\n  async listAction() {\r\n    const addressList = await this.model('address').where({user_id: this.getLoginUserId()}).select();\r\n    let itemKey = 0;\r\n    for (const addressItem of addressList) {\r\n      addressList[itemKey].province_name = await this.model('region').getRegionName(addressItem.province_id);\r\n      addressList[itemKey].city_name = await this.model('region').getRegionName(addressItem.city_id);\r\n      addressList[itemKey].district_name = await this.model('region').getRegionName(addressItem.district_id);\r\n      addressList[itemKey].full_region = addressList[itemKey].province_name + addressList[itemKey].city_name + addressList[itemKey].district_name;\r\n      itemKey += 1;\r\n    }\r\n\r\n    return this.success(addressList);\r\n  }\r\n\r\n  /**\r\n   * 获取收货地址的详情\r\n   * @return {Promise} []\r\n   */\r\n  async detailAction() {\r\n    const addressId = this.get('id');\r\n\r\n    const addressInfo = await this.model('address').where({user_id: this.getLoginUserId(), id: addressId}).find();\r\n    if (!think.isEmpty(addressInfo)) {\r\n      addressInfo.province_name = await this.model('region').getRegionName(addressInfo.province_id);\r\n      addressInfo.city_name = await this.model('region').getRegionName(addressInfo.city_id);\r\n      addressInfo.district_name = await this.model('region').getRegionName(addressInfo.district_id);\r\n      addressInfo.full_region = addressInfo.province_name + addressInfo.city_name + addressInfo.district_name;\r\n    }\r\n\r\n    return this.success(addressInfo);\r\n  }\r\n\r\n  /**\r\n   * 添加或更新收货地址\r\n   * @returns {Promise.<Promise|PreventPromise|void>}\r\n   */\r\n  async saveAction() {\r\n    let addressId = this.post('id');\r\n\r\n    const addressData = {\r\n      name: this.post('name'),\r\n      mobile: this.post('mobile'),\r\n      province_id: this.post('province_id'),\r\n      city_id: this.post('city_id'),\r\n      district_id: this.post('district_id'),\r\n      address: this.post('address'),\r\n      user_id: this.getLoginUserId(),\r\n      is_default: this.post('is_default') === true ? 1 : 0\r\n    };\r\n\r\n    if (think.isEmpty(addressId)) {\r\n      addressId = await this.model('address').add(addressData);\r\n    } else {\r\n      await this.model('address').where({id: addressId, user_id: this.getLoginUserId()}).update(addressData);\r\n    }\r\n\r\n    // 如果设置为默认，则取消其它的默认\r\n    if (this.post('is_default') === true) {\r\n      await this.model('address').where({id: ['<>', addressId], user_id: this.getLoginUserId()}).update({\r\n        is_default: 0\r\n      });\r\n    }\r\n    const addressInfo = await this.model('address').where({id: addressId}).find();\r\n\r\n    return this.success(addressInfo);\r\n  }\r\n\r\n  /**\r\n   * 删除指定的收货地址\r\n   * @returns {Promise.<Promise|PreventPromise|void>}\r\n   */\r\n  async deleteAction() {\r\n    const addressId = this.post('id');\r\n\r\n    await this.model('address').where({id: addressId, user_id: this.getLoginUserId()}).delete();\r\n\r\n    return this.success('删除成功');\r\n  }\r\n};\r\n"
    ]
}