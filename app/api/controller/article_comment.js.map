{
    "version": 3,
    "sources": [
        "../../../src/api/controller/article_comment.js"
    ],
    "names": [
        "_asyncToGenerator",
        "fn",
        "gen",
        "apply",
        "arguments",
        "Promise",
        "resolve",
        "reject",
        "step",
        "key",
        "arg",
        "info",
        "value",
        "error",
        "done",
        "then",
        "err",
        "Base",
        "require",
        "xss",
        "module",
        "exports",
        "ArticleInfoAction",
        "_this2",
        "id",
        "get",
        "model",
        "data",
        "where",
        "article_id",
        "find",
        "open_id",
        "success",
        "CommentListAction",
        "_this",
        "user_id",
        "getLoginUserId",
        "page",
        "size",
        "name",
        "field",
        "order",
        "select",
        "CommentDeleteAction",
        "allowMethods",
        "comment_id",
        "post",
        "commentInfo",
        "ArticleInfo",
        "limit",
        "delete",
        "new_num_comment",
        "num_comment",
        "update",
        "CommentPostAction",
        "comment_content",
        "userInfo",
        "weixin_openid",
        "nickname",
        "avatar",
        "add"
    ],
    "mappings": "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",
    "file": "../../../src/api/controller/article_comment.js",
    "sourcesContent": [
        "function _asyncToGenerator(fn) {\n    return function () {\n      var gen = fn.apply(this, arguments);return new Promise(function (resolve, reject) {\n        function step(key, arg) {\n          try {\n            var info = gen[key](arg);var value = info.value;\n          } catch (error) {\n            reject(error);return;\n          }if (info.done) {\n            resolve(value);\n          } else {\n            return Promise.resolve(value).then(function (value) {\n              step(\"next\", value);\n            }, function (err) {\n              step(\"throw\", err);\n            });\n          }\n        }return step(\"next\");\n      });\n    };\n  }\n  \n  const Base = require('./base.js');\n  const xss = require(\"xss\");\n  module.exports = class extends Base {\n    /**\n     * index action\n     * @return {Promise} []\n     */\n    ArticleInfoAction() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        const id = _this2.get('article_id');\n        const model = _this2.model('post_article');\n        var data = yield model.where({ article_id: id }).find();\n        delete data.open_id;\n        return _this2.success(data);\n      })();\n    }\n    CommentListAction() {\n        var _this = this;\n        return _asyncToGenerator(function* () {\n            const user_id = _this.getLoginUserId();\n            const model = _this.model(\"comment_article\");\n            const page = _this.get('page') || 1;\n            const size = _this.get('offset') || 20;\n            const name = _this.get('name') || '';\n            const article_id = _this.get('article_id') || 0;\n            var data = [];\n            data = yield model.field(['id','article_id','comment_content','post_date','nickname','avatar','user_id']).where({article_id:article_id}).order(['id DESC']).page(page, size).select();\n            return _this.success(data);\n          })();\n    }\n    CommentDeleteAction() {\n        var _this = this;\n        this.allowMethods = 'POST';\n        return _asyncToGenerator(function* () {\n            const model = _this.model(\"post_article\");\n            const user_id = _this.getLoginUserId();\n            const comment_id = _this.post('comment_id');\n            var commentInfo = yield _this.model('comment_article').where({ id: comment_id }).find();\n            var ArticleInfo = yield _this.model('post_article').where({ article_id: commentInfo.article_id }).find();\n            var data = [];\n            data = yield _this.model('comment_article').where({id:comment_id,user_id:user_id}).limit(1).delete();\n            let new_num_comment = ArticleInfo.num_comment-1;\n            if(new_num_comment < 0){\n                new_num_comment=0;\n            }\n            data = yield model.where({article_id:commentInfo.article_id,user_id:user_id}).limit(1).update({num_comment:new_num_comment});\n            return _this.success(data);\n          })();\n    }\n    CommentPostAction() {\n        this.allowMethods = 'POST';\n        var _this = this;\n        return _asyncToGenerator(function* () {\n          var user_id = _this.getLoginUserId();\n          var value = _this.post();\n          value.comment_content = xss(_this.post(\"comment_content\"));\n          var userInfo = yield _this.model('user').where({ id: user_id }).find();\n          var ArticleInfo = yield _this.model('post_article').where({ article_id: value.article_id }).find();\n          value.open_id = userInfo.weixin_openid;\n          value.nickname = userInfo.nickname;\n          value.avatar = userInfo.avatar;\n          value.user_id = user_id;\n          var data = yield _this.model('comment_article').add(value);\n          data = yield _this.model('post_article').where({ article_id: value.article_id }).update({num_comment:ArticleInfo.num_comment+1});\n          return _this.success(data);\n        })();\n      }\n\n  \n  };\n  //# sourceMappingURL=brand.js.map"
    ]
}