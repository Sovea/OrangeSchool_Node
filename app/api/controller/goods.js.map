{
    "version": 3,
    "sources": [
        "../../../src/api/controller/goods.js"
    ],
    "names": [
        "_asyncToGenerator",
        "fn",
        "gen",
        "apply",
        "arguments",
        "Promise",
        "resolve",
        "reject",
        "step",
        "key",
        "arg",
        "info",
        "value",
        "error",
        "done",
        "then",
        "err",
        "Base",
        "require",
        "fs",
        "module",
        "exports",
        "indexAction",
        "_this",
        "model",
        "goodsList",
        "select",
        "success",
        "skuAction",
        "_this2",
        "goodsId",
        "get",
        "specificationList",
        "getSpecificationList",
        "productList",
        "getProductList",
        "detailAction",
        "_this3",
        "where",
        "find",
        "gallery",
        "goods_id",
        "limit",
        "attribute",
        "field",
        "join",
        "order",
        "issue",
        "brand",
        "id",
        "brand_id",
        "commentCount",
        "value_id",
        "type_id",
        "count",
        "hotComment",
        "commentInfo",
        "think",
        "isEmpty",
        "commentUser",
        "user_id",
        "content",
        "Buffer",
        "from",
        "toString",
        "add_time",
        "datetime",
        "Date",
        "nickname",
        "avatar",
        "pic_list",
        "comment_id",
        "comment",
        "data",
        "userHasCollect",
        "isUserHasCollect",
        "getLoginUserId",
        "addFootprint",
        "goodPicAction",
        "goodFile",
        "file",
        "fail",
        "that",
        "filename",
        "uuid",
        "is",
        "createReadStream",
        "path",
        "os",
        "createWriteStream",
        "ROOT_PATH",
        "pipe",
        "name",
        "fileUrl",
        "my_goodsAction",
        "model1",
        "item",
        "gooddetail",
        "storeAction",
        "isPost",
        "values",
        "post",
        "console",
        "log",
        "open_id",
        "model2",
        "model3",
        "list_pic_url",
        "img_url",
        "myuser_id",
        "temp_data",
        "weixin_openid",
        "img",
        "is_on_sale",
        "is_new",
        "is_hot",
        "update",
        "add",
        "goods_number",
        "retail_price",
        "good_id",
        "max",
        "goods_sn",
        "primary_product_id",
        "good_status",
        "goods_specification_ids",
        "img_desc",
        "sort_order",
        "destorymyAction",
        "_this4",
        "tempdata",
        "true_userid",
        "delete",
        "categoryAction",
        "currentCategory",
        "parentCategory",
        "parent_id",
        "brotherCategory",
        "listAction",
        "_this5",
        "categoryId",
        "brandId",
        "keyword",
        "isNew",
        "isHot",
        "page",
        "size",
        "sort",
        "goodsQuery",
        "whereMap",
        "parseInt",
        "getTime",
        "orderMap",
        "filterCategory",
        "categoryIds",
        "getField",
        "parentIds",
        "concat",
        "category_id",
        "getCategoryWhereIn",
        "goodsData",
        "countSelect",
        "map",
        "v",
        "checked",
        "filterAction",
        "_this6",
        "getChildCategoryId",
        "newAction",
        "_this7",
        "bannerInfo",
        "url",
        "hotAction",
        "_this8",
        "relatedAction",
        "_this9",
        "relatedGoodsIds",
        "relatedGoods",
        "goodsCategory",
        "countAction",
        "_this10",
        "goodsCount",
        "is_delete"
    ],
    "mappings": "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",
    "file": "../../../src/api/controller/goods.js",
    "sourcesContent": [
        "function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step(\"next\", value); }, function (err) { step(\"throw\", err); }); } } return step(\"next\"); }); }; }\r\n\r\nconst Base = require('./base.js');\r\nconst fs = require('fs');\r\nmodule.exports = class extends Base {\r\n  indexAction() {\r\n    var _this = this;\r\n\r\n    return _asyncToGenerator(function* () {\r\n      const model = _this.model('goods');\r\n      const goodsList = yield model.select();\r\n\r\n      return _this.success(goodsList);\r\n    })();\r\n  }\r\n\r\n  /**\r\n   * 获取sku信息，用于购物车编辑时选择规格\r\n   * @returns {Promise.<Promise|PreventPromise|void>}\r\n   */\r\n  skuAction() {\r\n    var _this2 = this;\r\n\r\n    return _asyncToGenerator(function* () {\r\n      const goodsId = _this2.get('id');\r\n      const model = _this2.model('goods');\r\n\r\n      return _this2.success({\r\n        specificationList: yield model.getSpecificationList(goodsId),\r\n        productList: yield model.getProductList(goodsId)\r\n      });\r\n    })();\r\n  }\r\n\r\n  /**\r\n   * 商品详情页数据\r\n   * @returns {Promise.<Promise|PreventPromise|void>}\r\n   */\r\n  detailAction() {\r\n    var _this3 = this;\r\n\r\n    return _asyncToGenerator(function* () {\r\n      const goodsId = _this3.get('id');\r\n      const model = _this3.model('goods');\r\n\r\n      const info = yield model.where({ 'id': goodsId }).find();\r\n      const gallery = yield _this3.model('goods_gallery').where({ goods_id: goodsId }).limit(4).select();\r\n      const attribute = yield _this3.model('goods_attribute').field('nideshop_goods_attribute.value, nideshop_attribute.name').join('nideshop_attribute ON nideshop_goods_attribute.attribute_id=nideshop_attribute.id').order({ 'nideshop_goods_attribute.id': 'asc' }).where({ 'nideshop_goods_attribute.goods_id': goodsId }).select();\r\n      const issue = yield _this3.model('goods_issue').select();\r\n      const brand = yield _this3.model('brand').where({ id: info.brand_id }).find();\r\n      const commentCount = yield _this3.model('comment').where({ value_id: goodsId, type_id: 0 }).count();\r\n      const hotComment = yield _this3.model('comment').where({ value_id: goodsId, type_id: 0 }).find();\r\n      let commentInfo = {};\r\n      if (!think.isEmpty(hotComment)) {\r\n        const commentUser = yield _this3.model('user').field(['nickname', 'username', 'avatar']).where({ id: hotComment.user_id }).find();\r\n        commentInfo = {\r\n          content: Buffer.from(hotComment.content, 'base64').toString(),\r\n          add_time: think.datetime(new Date(hotComment.add_time * 1000)),\r\n          nickname: commentUser.nickname,\r\n          avatar: commentUser.avatar,\r\n          pic_list: yield _this3.model('comment_picture').where({ comment_id: hotComment.id }).select()\r\n        };\r\n      }\r\n\r\n      const comment = {\r\n        count: commentCount,\r\n        data: commentInfo\r\n      };\r\n\r\n      // 当前用户是否收藏\r\n      const userHasCollect = yield _this3.model('collect').isUserHasCollect(_this3.getLoginUserId(), 0, goodsId);\r\n\r\n      // 记录用户的足迹 TODO\r\n      yield yield _this3.model('footprint').addFootprint(_this3.getLoginUserId(), goodsId);\r\n\r\n      // return this.json(jsonData);\r\n      return _this3.success({\r\n        info: info,\r\n        gallery: gallery,\r\n        attribute: attribute,\r\n        userHasCollect: userHasCollect,\r\n        issue: issue,\r\n        comment: comment,\r\n        brand: brand,\r\n        specificationList: yield model.getSpecificationList(goodsId),\r\n        productList: yield model.getProductList(goodsId)\r\n      });\r\n    })();\r\n  }\r\n  goodPicAction() {\r\n    var _this = this;\r\n\r\n    return _asyncToGenerator(function* () {\r\n      const goodFile = _this.file('good_pic');\r\n      if (think.isEmpty(goodFile)) {\r\n        return _this.fail('保存失败');\r\n      }\r\n      const that = _this;\r\n      const filename = 'static/upload/good/' + think.uuid(32) + '.jpg';\r\n      const is = fs.createReadStream(goodFile.path);\r\n      const os = fs.createWriteStream(think.ROOT_PATH + '/www/' + filename);\r\n      is.pipe(os);\r\n\r\n      return that.success({\r\n        name: 'good_pic',\r\n        fileUrl: 'https://wjlpt.com/nideshop_api' + filename\r\n      });\r\n    })();\r\n  }\r\n  my_goodsAction(){\r\n    var _this = this;\r\n    return _asyncToGenerator(function* () {\r\n      const model = _this.model('goods');\r\n      const model1 = _this.model('user_goods');\r\n      var goodsList = yield model1.where({ user_id: _this.getLoginUserId() }).select();\r\n      for (const item of goodsList) {\r\n        item.gooddetail = yield model.where({ id: item.goods_id }).find();\r\n      }\r\n      return _this.success(goodsList);\r\n    })();\r\n  }\r\n  storeAction() {\r\n    var _this3 = this;\r\n\r\n    return _asyncToGenerator(function* () {\r\n      if (!_this3.isPost) {\r\n        return false;\r\n      }\r\n\r\n      var values = _this3.post();\r\n      console.log(values);\r\n      const id = _this3.post('id');\r\n      var open_id;\r\n      const model = _this3.model('goods');\r\n      const model2 = _this3.model('goods_gallery');\r\n      const model3 = _this3.model('user_goods');\r\n      values.list_pic_url==_this3.post('list_pic_url')||\"\";\r\n      var img_url = _this3.post('img_url');\r\n      var myuser_id =_this3.getLoginUserId();\r\n      if(myuser_id>0){\r\n        let temp_data = yield _this3.model('user').where({id:myuser_id}).find();\r\n        open_id = temp_data.weixin_openid;\r\n      }else{\r\n        return false;\r\n      }\r\n      var img;\r\n      delete values.img_url;\r\n      console.log(img_url);\r\n      // img_url = img_url.split(',');\r\n      values.is_on_sale=0;\r\n      // values.is_on_sale = values.is_on_sale ? 1 : 0;\r\n      values.is_new = values.is_new ? 1 : 0;\r\n      values.is_hot = values.is_hot ? 1 : 0;\r\n      if(values.list_pic_url==\"\"){\r\n        if(img_url[0]){\r\n          values.list_pic_url = img_url[0];\r\n        }\r\n      }\r\n      if (id > 0) {\r\n        yield model.where({ id: id }).update(values);\r\n        yield _this3.model('product').add({goods_number:values.goods_number,retail_price:values.retail_price});\r\n      } else {\r\n        delete values.id;\r\n        yield model.add(values);\r\n        var good_id = yield model.max('id');\r\n        values.id = good_id;\r\n        yield model.where({ id: good_id }).update({goods_sn:good_id,primary_product_id:good_id});\r\n        yield model3.add({goods_id:good_id,user_id:myuser_id,open_id:open_id,good_status:0});\r\n        yield _this3.model('product').add({goods_id:good_id,goods_specification_ids:\"\",goods_sn:good_id,goods_number:values.goods_number,retail_price:values.retail_price});\r\n        for(img in img_url){\r\n          console.log(img);\r\n          yield model2.add({goods_id:good_id,img_url:img_url[img],img_desc:\"\",sort_order:values.sort_order});\r\n        }\r\n        \r\n      }\r\n      return _this3.success(values);\r\n    })();\r\n  }\r\n\r\n  destorymyAction() {\r\n    var _this4 = this;\r\n    return _asyncToGenerator(function* () {\r\n      const id = _this4.post('id');\r\n      var tempdata = yield _this4.model('user_goods').where({ goods_id: id }).limit(1).find();\r\n      var true_userid = tempdata.user_id;\r\n      if(true_userid==_this4.getLoginUserId()){\r\n        var value = yield _this4.model('goods').where({ id: id }).limit(1).find();\r\n        yield _this4.model('user_goods').where({ goods_id: id }).limit(1).delete();\r\n        yield _this4.model('goods').where({ id: id }).limit(1).delete();\r\n        yield _this4.model('goods_gallery').where({ goods_id: id }).delete();\r\n      }\r\n      \r\n      // TODO 删除图片\r\n      return _this4.success();\r\n    })();\r\n  };\r\n  /**\r\n   * 获取分类下的商品\r\n   * @returns {Promise.<*>}\r\n   */\r\n  categoryAction() {\r\n    var _this4 = this;\r\n\r\n    return _asyncToGenerator(function* () {\r\n      const model = _this4.model('category');\r\n      const currentCategory = yield model.where({ id: _this4.get('id') }).find();\r\n      const parentCategory = yield model.where({ id: currentCategory.parent_id }).find();\r\n      const brotherCategory = yield model.where({ parent_id: currentCategory.parent_id }).select();\r\n\r\n      return _this4.success({\r\n        currentCategory: currentCategory,\r\n        parentCategory: parentCategory,\r\n        brotherCategory: brotherCategory\r\n      });\r\n    })();\r\n  }\r\n\r\n  /**\r\n   * 获取商品列表\r\n   * @returns {Promise.<*>}\r\n   */\r\n  listAction() {\r\n    var _this5 = this;\r\n\r\n    return _asyncToGenerator(function* () {\r\n      const categoryId = _this5.get('categoryId');\r\n      const brandId = _this5.get('brandId');\r\n      const keyword = _this5.get('keyword');\r\n      const isNew = _this5.get('isNew');\r\n      const isHot = _this5.get('isHot');\r\n      const page = _this5.get('page');\r\n      const size = _this5.get('size');\r\n      const sort = _this5.get('sort');\r\n      const order = _this5.get('order');\r\n\r\n      const goodsQuery = _this5.model('goods');\r\n\r\n      const whereMap = {};\r\n      if (!think.isEmpty(isNew)) {\r\n        whereMap.is_new = isNew;\r\n      }\r\n\r\n      if (!think.isEmpty(isHot)) {\r\n        whereMap.is_hot = isHot;\r\n      }\r\n\r\n      if (!think.isEmpty(keyword)) {\r\n        whereMap.name = ['like', `%${keyword}%`];\r\n        // 添加到搜索历史\r\n        yield _this5.model('search_history').add({\r\n          keyword: keyword,\r\n          user_id: _this5.getLoginUserId(),\r\n          add_time: parseInt(new Date().getTime() / 1000)\r\n        });\r\n      }\r\n\r\n      if (!think.isEmpty(brandId)) {\r\n        whereMap.brand_id = brandId;\r\n      }\r\n\r\n      // 排序\r\n      let orderMap = {};\r\n      if (sort === 'price') {\r\n        // 按价格\r\n        orderMap = {\r\n          retail_price: order\r\n        };\r\n      } else {\r\n        // 按商品添加时间\r\n        orderMap = {\r\n          id: 'desc'\r\n        };\r\n      }\r\n\r\n      // 筛选的分类\r\n      let filterCategory = [{\r\n        'id': 0,\r\n        'name': '全部',\r\n        'checked': false\r\n      }];\r\n\r\n      const categoryIds = yield goodsQuery.where(whereMap).getField('category_id', 10000);\r\n      if (!think.isEmpty(categoryIds)) {\r\n        // 查找二级分类的parent_id\r\n        const parentIds = yield _this5.model('category').where({ id: { 'in': categoryIds } }).getField('parent_id', 10000);\r\n        // 一级分类\r\n        const parentCategory = yield _this5.model('category').field(['id', 'name']).order({ 'sort_order': 'asc' }).where({ 'id': { 'in': parentIds } }).select();\r\n\r\n        if (!think.isEmpty(parentCategory)) {\r\n          filterCategory = filterCategory.concat(parentCategory);\r\n        }\r\n      }\r\n\r\n      // 加入分类条件\r\n      if (!think.isEmpty(categoryId) && parseInt(categoryId) > 0) {\r\n        whereMap.category_id = ['in', yield _this5.model('category').getCategoryWhereIn(categoryId)];\r\n      }\r\n\r\n      // 搜索到的商品\r\n      const goodsData = yield goodsQuery.where(whereMap).field(['id', 'name', 'list_pic_url', 'retail_price','is_on_sale']).order(orderMap).page(page, size).countSelect();\r\n      goodsData.filterCategory = filterCategory.map(function (v) {\r\n        v.checked = think.isEmpty(categoryId) && v.id === 0 || v.id === parseInt(categoryId);\r\n        return v;\r\n      });\r\n      goodsData.goodsList = goodsData.data;\r\n\r\n      return _this5.success(goodsData);\r\n    })();\r\n  }\r\n\r\n  /**\r\n   * 商品列表筛选的分类列表\r\n   * @returns {Promise.<Promise|void|PreventPromise>}\r\n   */\r\n  filterAction() {\r\n    var _this6 = this;\r\n\r\n    return _asyncToGenerator(function* () {\r\n      const categoryId = _this6.get('categoryId');\r\n      const keyword = _this6.get('keyword');\r\n      const isNew = _this6.get('isNew');\r\n      const isHot = _this6.get('isHot');\r\n\r\n      const goodsQuery = _this6.model('goods');\r\n\r\n      if (!think.isEmpty(categoryId)) {\r\n        goodsQuery.where({ category_id: { 'in': yield _this6.model('category').getChildCategoryId(categoryId) } });\r\n      }\r\n\r\n      if (!think.isEmpty(isNew)) {\r\n        goodsQuery.where({ is_new: isNew });\r\n      }\r\n\r\n      if (!think.isEmpty(isHot)) {\r\n        goodsQuery.where({ is_hot: isHot });\r\n      }\r\n\r\n      if (!think.isEmpty(keyword)) {\r\n        goodsQuery.where({ name: { 'like': `%${keyword}%` } });\r\n      }\r\n\r\n      let filterCategory = [{\r\n        'id': 0,\r\n        'name': '全部'\r\n      }];\r\n\r\n      // 二级分类id\r\n      const categoryIds = yield goodsQuery.getField('category_id', 10000);\r\n      if (!think.isEmpty(categoryIds)) {\r\n        // 查找二级分类的parent_id\r\n        const parentIds = yield _this6.model('category').where({ id: { 'in': categoryIds } }).getField('parent_id', 10000);\r\n        // 一级分类\r\n        const parentCategory = yield _this6.model('category').field(['id', 'name']).order({ 'sort_order': 'asc' }).where({ 'id': { 'in': parentIds } }).select();\r\n\r\n        if (!think.isEmpty(parentCategory)) {\r\n          filterCategory = filterCategory.concat(parentCategory);\r\n        }\r\n      }\r\n\r\n      return _this6.success(filterCategory);\r\n    })();\r\n  }\r\n\r\n  /**\r\n   * 新品首发\r\n   * @returns {Promise.<Promise|void|PreventPromise>}\r\n   */\r\n  newAction() {\r\n    var _this7 = this;\r\n\r\n    return _asyncToGenerator(function* () {\r\n      return _this7.success({\r\n        bannerInfo: {\r\n          url: '',\r\n          name: '坚持初心，为你寻觅世间好物',\r\n          img_url: 'http://yanxuan.nosdn.127.net/8976116db321744084774643a933c5ce.png'\r\n        }\r\n      });\r\n    })();\r\n  }\r\n\r\n  /**\r\n   * 人气推荐\r\n   * @returns {Promise.<Promise|void|PreventPromise>}\r\n   */\r\n  hotAction() {\r\n    var _this8 = this;\r\n\r\n    return _asyncToGenerator(function* () {\r\n      return _this8.success({\r\n        bannerInfo: {\r\n          url: '',\r\n          name: '大家都在买的严选好物',\r\n          img_url: 'http://yanxuan.nosdn.127.net/8976116db321744084774643a933c5ce.png'\r\n        }\r\n      });\r\n    })();\r\n  }\r\n\r\n  /**\r\n   * 商品详情页的大家都在看的商品\r\n   * @returns {Promise.<Promise|PreventPromise|void>}\r\n   */\r\n  relatedAction() {\r\n    var _this9 = this;\r\n\r\n    return _asyncToGenerator(function* () {\r\n      // 大家都在看商品,取出关联表的商品，如果没有则随机取同分类下的商品\r\n      const model = _this9.model('goods');\r\n      const goodsId = _this9.get('id');\r\n      const relatedGoodsIds = yield _this9.model('related_goods').where({ goods_id: goodsId}).getField('related_goods_id');\r\n      let relatedGoods = null;\r\n      if (think.isEmpty(relatedGoodsIds)) {\r\n        // 查找同分类下的商品\r\n        const goodsCategory = yield model.where({ id: goodsId }).find();\r\n        relatedGoods = yield model.where({ category_id: goodsCategory.category_id,is_on_sale:1}).field(['id', 'name', 'list_pic_url', 'retail_price']).limit(8).select();\r\n      } else {\r\n        relatedGoods = yield model.where({ id: ['IN', relatedGoodsIds],is_on_sale:1 }).field(['id', 'name', 'list_pic_url', 'retail_price']).select();\r\n      }\r\n\r\n      return _this9.success({\r\n        goodsList: relatedGoods\r\n      });\r\n    })();\r\n  }\r\n\r\n  /**\r\n   * 在售的商品总数\r\n   * @returns {Promise.<Promise|PreventPromise|void>}\r\n   */\r\n  countAction() {\r\n    var _this10 = this;\r\n\r\n    return _asyncToGenerator(function* () {\r\n      const goodsCount = yield _this10.model('goods').where({ is_delete: 0, is_on_sale: 1 }).count('id');\r\n\r\n      return _this10.success({\r\n        goodsCount: goodsCount\r\n      });\r\n    })();\r\n  }\r\n};\r\n//# sourceMappingURL=goods.js.map"
    ]
}