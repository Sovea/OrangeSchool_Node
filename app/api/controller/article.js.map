{
    "version": 3,
    "sources": [
        "../../../src/api/controller/article.js"
    ],
    "names": [
        "_asyncToGenerator",
        "fn",
        "gen",
        "apply",
        "arguments",
        "Promise",
        "resolve",
        "reject",
        "step",
        "key",
        "arg",
        "info",
        "value",
        "error",
        "done",
        "then",
        "err",
        "Base",
        "require",
        "xss",
        "fs",
        "module",
        "exports",
        "ArticleInfoAction",
        "_this2",
        "id",
        "get",
        "model",
        "data",
        "where",
        "article_id",
        "find",
        "new_article_view",
        "article_view",
        "string_date",
        "formatDate",
        "article_post_time",
        "update",
        "open_id",
        "success",
        "ArticleSearchAction",
        "_this",
        "page",
        "size",
        "keyword",
        "field",
        "article_header",
        "order",
        "select",
        "ArticleListAction",
        "name",
        "article_type",
        "user_id",
        "getLoginUserId",
        "item",
        "ArticleLikeAction",
        "post_like",
        "ArticleInfo",
        "new_num_like",
        "num_like",
        "ArticleDeleteAction",
        "allowMethods",
        "post",
        "model1",
        "db",
        "limit",
        "delete",
        "good_pic",
        "model2",
        "good_pics",
        "console",
        "log",
        "temp_arr",
        "img_url",
        "toString",
        "split",
        "temp_name",
        "slice",
        "think",
        "ROOT_PATH",
        "unlink",
        "ArticlePicAction",
        "articleFile",
        "file",
        "isEmpty",
        "fail",
        "that",
        "filename",
        "uuid",
        "is",
        "createReadStream",
        "path",
        "os",
        "createWriteStream",
        "pipe",
        "fileUrl",
        "PostArticleAction",
        "article_abstract",
        "article_content",
        "on_top",
        "images_url",
        "headimg_man",
        "headimg_woman",
        "userInfo",
        "weixin_openid",
        "num_comment",
        "username",
        "nickname",
        "head_img",
        "avatar",
        "gender",
        "add",
        "each_item",
        "date",
        "format",
        "Date",
        "replace",
        "dict",
        "getFullYear",
        "getMonth",
        "getDate",
        "getHours",
        "getMinutes",
        "getSeconds",
        "substr"
    ],
    "mappings": "AAAA,SAASA,iBAAT,CAA2BC,EAA3B,EAA+B;AAC3B,SAAO,YAAY;AACjB,QAAIC,MAAMD,GAAGE,KAAH,CAAS,IAAT,EAAeC,SAAf,CAAV,CAAoC,OAAO,IAAIC,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAChF,eAASC,IAAT,CAAcC,GAAd,EAAmBC,GAAnB,EAAwB;AACtB,YAAI;AACF,cAAIC,OAAOT,IAAIO,GAAJ,EAASC,GAAT,CAAX,CAAyB,IAAIE,QAAQD,KAAKC,KAAjB;AAC1B,SAFD,CAEE,OAAOC,KAAP,EAAc;AACdN,iBAAOM,KAAP,EAAc;AACf,aAAIF,KAAKG,IAAT,EAAe;AACdR,kBAAQM,KAAR;AACD,SAFA,MAEM;AACL,iBAAOP,QAAQC,OAAR,CAAgBM,KAAhB,EAAuBG,IAAvB,CAA4B,UAAUH,KAAV,EAAiB;AAClDJ,iBAAK,MAAL,EAAaI,KAAb;AACD,WAFM,EAEJ,UAAUI,GAAV,EAAe;AAChBR,iBAAK,OAAL,EAAcQ,GAAd;AACD,WAJM,CAAP;AAKD;AACF,cAAOR,KAAK,MAAL,CAAP;AACF,KAhB0C,CAAP;AAiBrC,GAlBD;AAmBD;;AAED,MAAMS,OAAOC,QAAQ,WAAR,CAAb;AACA,MAAMC,MAAMD,QAAQ,KAAR,CAAZ;AACA,MAAME,KAAKF,QAAQ,IAAR,CAAX;AACAG,OAAOC,OAAP,GAAiB,cAAcL,IAAd,CAAmB;AAClC;;;;AAIAM,sBAAoB;AAClB,QAAIC,SAAS,IAAb;AACA,WAAOxB,kBAAkB,aAAa;AACpC,YAAMyB,KAAKD,OAAOE,GAAP,CAAW,YAAX,CAAX;AACA,YAAMC,QAAQH,OAAOG,KAAP,CAAa,cAAb,CAAd;AACA,UAAIC,OAAO,MAAMD,MAAME,KAAN,CAAY,EAAEC,YAAYL,EAAd,EAAZ,EAAgCM,IAAhC,EAAjB;AACA,UAAIC,mBAAmBJ,KAAKK,YAAL,GAAkB,CAAzC;AACAL,WAAKM,WAAL,GAAmBC,WAAWP,KAAKQ,iBAAhB,EAAkC,qBAAlC,CAAnB;AACA,YAAMT,MAAME,KAAN,CAAY,EAAEC,YAAYL,EAAd,EAAZ,EAAgCY,MAAhC,CAAuC,EAACJ,cAAaD,gBAAd,EAAvC,CAAN;AACA,aAAOJ,KAAKU,OAAZ;AACA,aAAOd,OAAOe,OAAP,CAAeX,IAAf,CAAP;AACD,KATM,GAAP;AAUD;AACDY,wBAAsB;AAClB,QAAIC,QAAQ,IAAZ;AACA,WAAOzC,kBAAkB,aAAa;AAClC,YAAM2B,QAAQc,MAAMd,KAAN,CAAY,cAAZ,CAAd;AACA,YAAMe,OAAOD,MAAMf,GAAN,CAAU,MAAV,KAAqB,CAAlC;AACA,YAAMiB,OAAOF,MAAMf,GAAN,CAAU,QAAV,KAAuB,EAApC;AACA,YAAMkB,UAAUH,MAAMf,GAAN,CAAU,SAAV,KAAwB,EAAxC;AACA,UAAIE,OAAO,EAAX;AACIA,aAAO,MAAMD,MAAMkB,KAAN,CAAY,CAAC,YAAD,EAAe,gBAAf,EAAiC,iBAAjC,EAAoD,kBAApD,EAAwE,mBAAxE,EAA6F,UAA7F,EAAyG,aAAzG,EAAwH,cAAxH,EAAwI,cAAxI,EAAuJ,UAAvJ,EAAkK,UAAlK,EAA6K,SAA7K,EAAuL,WAAvL,EAAmM,QAAnM,CAAZ,EAA0NhB,KAA1N,CAAgO,EAAEiB,gBAAgB,CAAC,MAAD,EAAU,IAAGF,OAAQ,GAArB,CAAlB,EAAhO,EAA6QG,KAA7Q,CAAmR,CAAC,aAAD,EAAe,iBAAf,CAAnR,EAAsTL,IAAtT,CAA2TA,IAA3T,EAAiUC,IAAjU,EAAuUK,MAAvU,EAAb;AACJ,aAAOP,MAAMF,OAAN,CAAcX,IAAd,CAAP;AACD,KARI,GAAP;AASH;;AAEDqB,sBAAoB;AAChB,QAAIR,QAAQ,IAAZ;AACA,WAAOzC,kBAAkB,aAAa;AAClC,YAAM2B,QAAQc,MAAMd,KAAN,CAAY,cAAZ,CAAd;AACA,YAAMe,OAAOD,MAAMf,GAAN,CAAU,MAAV,KAAqB,CAAlC;AACA,YAAMiB,OAAOF,MAAMf,GAAN,CAAU,QAAV,KAAuB,EAApC;AACA,YAAMwB,OAAOT,MAAMf,GAAN,CAAU,MAAV,KAAqB,EAAlC;AACA,YAAMyB,eAAeV,MAAMf,GAAN,CAAU,cAAV,KAA6B,CAAlD;AACA,YAAM0B,UAAUX,MAAMY,cAAN,MAA0B,CAA1C;AACA,UAAIzB,OAAO,EAAX;AACA,UAAI0B,IAAJ;AACA,UAAGH,eAAa,CAAb,IAAgBA,gBAAc,CAAjC,EAAmC;AACjCvB,eAAO,MAAMD,MAAMkB,KAAN,CAAY,CAAC,YAAD,EAAe,gBAAf,EAAiC,iBAAjC,EAAoD,kBAApD,EAAwE,mBAAxE,EAA6F,UAA7F,EAAyG,aAAzG,EAAwH,cAAxH,EAAwI,cAAxI,EAAuJ,UAAvJ,EAAkK,UAAlK,EAA6K,SAA7K,EAAuL,WAAvL,EAAmM,QAAnM,CAAZ,EAA0NhB,KAA1N,CAAgO,EAAEiB,gBAAgB,CAAC,MAAD,EAAU,IAAGI,IAAK,GAAlB,CAAlB,EAAyCC,cAAaA,YAAtD,EAAhO,EAAqSJ,KAArS,CAA2S,CAAC,aAAD,EAAe,iBAAf,CAA3S,EAA8UL,IAA9U,CAAmVA,IAAnV,EAAyVC,IAAzV,EAA+VK,MAA/V,EAAb;AACA,aAAIM,IAAJ,IAAY1B,IAAZ,EAAiB;AACfA,eAAK0B,IAAL,EAAWpB,WAAX,GAAyBC,WAAWP,KAAK0B,IAAL,EAAWlB,iBAAtB,EAAwC,qBAAxC,CAAzB;AACD;AAEF,OAND,MAOK,IAAGe,gBAAc,CAAjB,EAAmB;AACpBvB,eAAO,MAAMD,MAAMkB,KAAN,CAAY,CAAC,YAAD,EAAe,gBAAf,EAAiC,iBAAjC,EAAoD,kBAApD,EAAwE,mBAAxE,EAA6F,UAA7F,EAAyG,aAAzG,EAAwH,cAAxH,EAAwI,cAAxI,EAAuJ,UAAvJ,EAAkK,UAAlK,EAA6K,SAA7K,EAAuL,WAAvL,EAAmM,QAAnM,CAAZ,EAA0NhB,KAA1N,CAAgO,EAAEiB,gBAAgB,CAAC,MAAD,EAAU,IAAGI,IAAK,GAAlB,CAAlB,EAAwCE,SAAQA,OAAhD,EAAhO,EAA0RL,KAA1R,CAAgS,CAAC,aAAD,EAAe,iBAAf,CAAhS,EAAmUL,IAAnU,CAAwUA,IAAxU,EAA8UC,IAA9U,EAAoVK,MAApV,EAAb;AACA,aAAIM,IAAJ,IAAY1B,IAAZ,EAAiB;AACfA,eAAK0B,IAAL,EAAWpB,WAAX,GAAyBC,WAAWP,KAAK0B,IAAL,EAAWlB,iBAAtB,EAAwC,qBAAxC,CAAzB;AACD;AACF,OALE,MAME,IAAGe,gBAAc,CAAjB,EAAmB;AACtBvB,eAAO,MAAMD,MAAMkB,KAAN,CAAY,CAAC,YAAD,EAAe,gBAAf,EAAiC,iBAAjC,EAAoD,kBAApD,EAAwE,mBAAxE,EAA6F,UAA7F,EAAyG,aAAzG,EAAwH,cAAxH,EAAwI,cAAxI,EAAuJ,UAAvJ,EAAkK,UAAlK,EAA6K,SAA7K,EAAuL,WAAvL,EAAmM,QAAnM,CAAZ,EAA0NhB,KAA1N,CAAgO,EAAEiB,gBAAgB,CAAC,MAAD,EAAU,IAAGI,IAAK,GAAlB,CAAlB,EAAhO,EAA0QH,KAA1Q,CAAgR,CAAC,aAAD,EAAe,iBAAf,CAAhR,EAAmTL,IAAnT,CAAwTA,IAAxT,EAA8TC,IAA9T,EAAoUK,MAApU,EAAb;AACA,aAAIM,IAAJ,IAAY1B,IAAZ,EAAiB;AACfA,eAAK0B,IAAL,EAAWpB,WAAX,GAAyBC,WAAWP,KAAK0B,IAAL,EAAWlB,iBAAtB,EAAwC,qBAAxC,CAAzB;AACD;AACF;;AAEH,aAAOK,MAAMF,OAAN,CAAcX,IAAd,CAAP;AACD,KA9BI,GAAP;AA+BH;AACA2B,sBAAoB;AACjB,QAAId,QAAQ,IAAZ;AACA,WAAOzC,kBAAkB,aAAa;AAClC,YAAM2B,QAAQc,MAAMd,KAAN,CAAY,cAAZ,CAAd;AACA,YAAMG,aAAaW,MAAMf,GAAN,CAAU,YAAV,KAA2B,CAA9C;AACA,YAAM8B,YAAYf,MAAMf,GAAN,CAAU,WAAV,KAA0B,CAA5C;AACA,UAAIE,OAAO,EAAX;AACA;AACE,YAAM6B,cAAc,MAAM9B,MAAME,KAAN,CAAY,EAACC,YAAWA,UAAZ,EAAZ,EAAqCC,IAArC,EAA1B;AACA,UAAI2B,eAAeF,aAAW,CAAX,GAAeC,YAAYE,QAAZ,GAAqB,CAApC,GAAwCF,YAAYE,QAAZ,GAAqB,CAAhF;AACA,UAAGD,eAAe,CAAlB,EAAoB;AAChBA,uBAAa,CAAb;AACH;AACD9B,aAAO,MAAMD,MAAME,KAAN,CAAY,EAACC,YAAWA,UAAZ,EAAZ,EAAqCO,MAArC,CAA4C,EAACsB,UAASD,YAAV,EAA5C,CAAb;;AAEF;AACA,aAAOjB,MAAMF,OAAN,CAAcX,IAAd,CAAP;AACD,KAfI,GAAP;AAgBH;AACDgC,wBAAsB;AAClB,QAAInB,QAAQ,IAAZ;AACA,SAAKoB,YAAL,GAAoB,MAApB;AACA,WAAO7D,kBAAkB,aAAa;AAClC,YAAM2B,QAAQc,MAAMd,KAAN,CAAY,cAAZ,CAAd;AACA,YAAMG,aAAaW,MAAMqB,IAAN,CAAW,YAAX,CAAnB;AACA,YAAMV,UAAUX,MAAMY,cAAN,EAAhB;AACA,UAAIzB,OAAO,EAAX;AACA;AACE,YAAMmC,SAAStB,MAAMd,KAAN,CAAY,iBAAZ,EAA+BqC,EAA/B,CAAkCrC,MAAMqC,EAAN,EAAlC,CAAf;AACApC,aAAO,MAAMD,MAAME,KAAN,CAAY,EAAEC,YAAYA,UAAd,EAAyBsB,SAAQA,OAAjC,EAAZ,EAAuDa,KAAvD,CAA6D,CAA7D,EAAgEC,MAAhE,EAAb;AACAtC,aAAO,MAAMmC,OAAOlC,KAAP,CAAa,EAACC,YAAYA,UAAb,EAAb,EAAuCoC,MAAvC,EAAb;AACA,UAAIC,QAAJ;AACA,YAAMC,SAAS3B,MAAMd,KAAN,CAAY,iBAAZ,EAA+BqC,EAA/B,CAAkCrC,MAAMqC,EAAN,EAAlC,CAAf;AACA,YAAMK,YAAY,MAAMD,OAAOvB,KAAP,CAAa,CAAC,SAAD,CAAb,EAA0BhB,KAA1B,CAAgC,EAACC,YAAWA,UAAZ,EAAhC,EAAyDkB,MAAzD,EAAxB;AACA,YAAMoB,OAAOvB,KAAP,CAAa,CAAC,SAAD,CAAb,EAA0BhB,KAA1B,CAAgC,EAACC,YAAWA,UAAZ,EAAhC,EAAyDoC,MAAzD,EAAN;AACA,WAAIC,QAAJ,IAAgBE,SAAhB,EAA0B;AACxB;AACAC,gBAAQC,GAAR,CAAYF,UAAUF,QAAV,CAAZ;AACA,YAAIK,WAAYH,UAAUF,QAAV,EAAoBM,OAApB,CAA4BC,QAA5B,GAAuCC,KAAvC,CAA6C,GAA7C,CAAhB;AACA,YAAIC,YAAYJ,SAASK,KAAT,CAAe,CAAC,CAAhB,CAAhB;AACAD,oBAAYE,MAAMC,SAAN,GAAkB,OAAlB,GAA4B,wBAA5B,GAAqDH,SAAjE;AACAN,gBAAQC,GAAR,CAAYK,SAAZ;AACAxD,WAAG4D,MAAH,CAAUJ,SAAV,EAAoB,UAAS/D,KAAT,EAAe;AACjC,cAAGA,KAAH,EAAS;AACLyD,oBAAQC,GAAR,CAAY1D,KAAZ;AACA,mBAAO,KAAP;AACH;AACDyD,kBAAQC,GAAR,CAAY,QAAZ;AACD,SAND;AAQC;;AAEH,aAAO9B,MAAMF,OAAN,CAAcX,IAAd,CAAP;AACF;;AAID,KAnCI,GAAP;AAoCH;AACDqD,qBAAkB;AAChB,QAAIxC,QAAQ,IAAZ;;AAEF,WAAOzC,kBAAkB,aAAa;AACpC,YAAMkF,cAAczC,MAAM0C,IAAN,CAAW,aAAX,CAApB;AACA,UAAIL,MAAMM,OAAN,CAAcF,WAAd,CAAJ,EAAgC;AAC9B,eAAOzC,MAAM4C,IAAN,CAAW,MAAX,CAAP;AACD;AACD,YAAMC,OAAO7C,KAAb;AACA,YAAM8C,WAAW,2BAA2BT,MAAMU,IAAN,CAAW,EAAX,CAA3B,GAA4C,MAA7D;AACA,YAAMC,KAAKrE,GAAGsE,gBAAH,CAAoBR,YAAYS,IAAhC,CAAX;AACA,YAAMC,KAAKxE,GAAGyE,iBAAH,CAAqBf,MAAMC,SAAN,GAAkB,OAAlB,GAA4BQ,QAAjD,CAAX;AACAE,SAAGK,IAAH,CAAQF,EAAR;;AAEA,aAAON,KAAK/C,OAAL,CAAa;AAClBW,cAAM,aADY;AAElB6C,iBAAS,mCAAmCR;AAF1B,OAAb,CAAP;AAID,KAfM,GAAP;AAgBC;AACDS,sBAAoB;AAChB,SAAKnC,YAAL,GAAoB,MAApB;AACA,QAAIpB,QAAQ,IAAZ;AACA,WAAOzC,kBAAkB,aAAa;AACpC,YAAM2B,QAAQc,MAAMd,KAAN,CAAY,cAAZ,CAAd;AACA,UAAIyB,UAAUX,MAAMY,cAAN,EAAd;AACA,UAAIzC,QAAQ6B,MAAMqB,IAAN,EAAZ;AACAlD,YAAMkC,cAAN,GAAuB3B,IAAIsB,MAAMqB,IAAN,CAAW,gBAAX,CAAJ,CAAvB;AACAlD,YAAMqF,gBAAN,GAAyB9E,IAAIsB,MAAMqB,IAAN,CAAW,kBAAX,CAAJ,CAAzB;AACAlD,YAAMsF,eAAN,GAAwB/E,IAAIsB,MAAMqB,IAAN,CAAW,iBAAX,CAAJ,CAAxB;AACAlD,YAAMwB,iBAAN,GAA0BjB,IAAIsB,MAAMqB,IAAN,CAAW,mBAAX,CAAJ,CAA1B;AACAlD,YAAMuC,YAAN,GAAqBhC,IAAIsB,MAAMqB,IAAN,CAAW,cAAX,CAAJ,CAArB;AACAlD,YAAMuF,MAAN,GAAe1D,MAAMqB,IAAN,CAAW,QAAX,KAAsB,CAArC;AACAQ,cAAQC,GAAR,CAAY3D,MAAMwF,UAAlB;AACA,UAAIC,cAAc,6DAAlB;AACA,UAAIC,gBAAgB,+DAApB;;AAEA,UAAIC,WAAW,MAAM9D,MAAMd,KAAN,CAAY,MAAZ,EAAoBE,KAApB,CAA0B,EAAEJ,IAAI2B,OAAN,EAA1B,EAA2CrB,IAA3C,EAArB;AACAnB,YAAMwC,OAAN,GAAgBA,OAAhB;AACAxC,YAAM0B,OAAN,GAAgBiE,SAASC,aAAzB;AACA5F,YAAM+C,QAAN,GAAiB,CAAjB;AACA/C,YAAM6F,WAAN,GAAoB,CAApB;AACA7F,YAAMqB,YAAN,GAAqB,CAArB;AACArB,YAAM8F,QAAN,GAAiBH,SAASI,QAA1B;AACA/F,YAAMgG,QAAN,GAAiBL,SAASM,MAA1B;AACA,UAAIjG,MAAMuC,YAAN,IAAsB,CAA1B,EAA6B;AAC3BvC,cAAM8F,QAAN,GAAiBH,SAASO,MAAT,GAAkB,MAAlB,GAA2B,MAA5C;AACAlG,cAAMgG,QAAN,GAAiBL,SAASO,MAAT,GAAkBT,WAAlB,GAAgCC,aAAjD;AACD;AACD;AACE,YAAMxE,aAAa,MAAMH,MAAMoF,GAAN,CAAUnG,KAAV,CAAzB;AACA,YAAMmD,SAAStB,MAAMd,KAAN,CAAY,iBAAZ,EAA+BqC,EAA/B,CAAkCrC,MAAMqC,EAAN,EAAlC,CAAf;AACA,UAAIgD,SAAJ;AACA,WAAIA,SAAJ,IAAiBpG,MAAMwF,UAAvB,EAAkC;AAChC,cAAMrC,OAAOgD,GAAP,CAAW,EAACjF,YAAWA,UAAZ,EAAuB2C,SAAQ7D,MAAMwF,UAAN,CAAiBY,SAAjB,CAA/B,EAAX,CAAN;AACD;AACD,aAAOpG,MAAM0B,OAAb;AACA,aAAOG,MAAMF,OAAN,CAAc3B,KAAd,CAAP;AACF;;AAID,KAvCM,GAAP;AAwCD;;AA3L+B,CAApC;AA+LA;;;;AAIA,SAASuB,UAAT,CAAoB8E,IAApB,EAA0BC,MAA1B,EAAkC;AAChC,MAAI,CAACD,IAAL,EAAW;AACX,MAAI,CAACC,MAAL,EAAaA,SAAS,YAAT;AACb,UAAO,OAAOD,IAAd;AACI,SAAK,QAAL;AACIA,aAAO,IAAIE,IAAJ,CAASF,KAAKG,OAAL,CAAa,GAAb,EAAkB,GAAlB,CAAT,CAAP;AACA;AACJ,SAAK,QAAL;AACIH,aAAO,IAAIE,IAAJ,CAASF,IAAT,CAAP;AACA;AANR;AAQA,MAAI,CAACA,IAAD,YAAiBE,IAArB,EAA2B;AAC3B,MAAIE,OAAO;AACP,YAAQJ,KAAKK,WAAL,EADD;AAEP,SAAKL,KAAKM,QAAL,KAAkB,CAFhB;AAGP,SAAKN,KAAKO,OAAL,EAHE;AAIP,SAAKP,KAAKQ,QAAL,EAJE;AAKP,SAAKR,KAAKS,UAAL,EALE;AAMP,SAAKT,KAAKU,UAAL,EANE;AAOP,UAAM,CAAC,MAAMV,KAAKM,QAAL,KAAkB,GAAxB,CAAD,EAA+BK,MAA/B,CAAsC,CAAtC,CAPC;AAQP,UAAM,CAAC,MAAMX,KAAKO,OAAL,KAAiB,GAAvB,CAAD,EAA8BI,MAA9B,CAAqC,CAArC,CARC;AASP,UAAM,CAAC,MAAMX,KAAKQ,QAAL,KAAkB,GAAxB,CAAD,EAA+BG,MAA/B,CAAsC,CAAtC,CATC;AAUP,UAAM,CAAC,MAAMX,KAAKS,UAAL,KAAoB,GAA1B,CAAD,EAAiCE,MAAjC,CAAwC,CAAxC,CAVC;AAWP,UAAM,CAAC,MAAMX,KAAKU,UAAL,KAAoB,GAA1B,CAAD,EAAiCC,MAAjC,CAAwC,CAAxC;AAXC,GAAX;AAaA,SAAOV,OAAOE,OAAP,CAAe,6BAAf,EAA8C,YAAW;AAC5D,WAAOC,KAAKjH,UAAU,CAAV,CAAL,CAAP;AACH,GAFM,CAAP;AAGH;AACC",
    "file": "../../../src/api/controller/article.js",
    "sourcesContent": [
        "function _asyncToGenerator(fn) {\n    return function () {\n      var gen = fn.apply(this, arguments);return new Promise(function (resolve, reject) {\n        function step(key, arg) {\n          try {\n            var info = gen[key](arg);var value = info.value;\n          } catch (error) {\n            reject(error);return;\n          }if (info.done) {\n            resolve(value);\n          } else {\n            return Promise.resolve(value).then(function (value) {\n              step(\"next\", value);\n            }, function (err) {\n              step(\"throw\", err);\n            });\n          }\n        }return step(\"next\");\n      });\n    };\n  }\n  \n  const Base = require('./base.js');\n  const xss = require(\"xss\");\n  const fs = require('fs');\n  module.exports = class extends Base {\n    /**\n     * index action\n     * @return {Promise} []\n     */\n    ArticleInfoAction() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        const id = _this2.get('article_id');\n        const model = _this2.model('post_article');\n        var data = yield model.where({ article_id: id }).find();\n        var new_article_view = data.article_view+1;\n        data.string_date = formatDate(data.article_post_time,\"yyyy-MM-dd HH:mm:ss\");\n        yield model.where({ article_id: id }).update({article_view:new_article_view});\n        delete data.open_id;\n        return _this2.success(data);\n      })();\n    }\n    ArticleSearchAction() {\n        var _this = this;\n        return _asyncToGenerator(function* () {\n            const model = _this.model(\"post_article\");\n            const page = _this.get('page') || 1;\n            const size = _this.get('offset') || 20;\n            const keyword = _this.get('keyword') || '';\n            var data = [];\n                data = yield model.field(['article_id', 'article_header', 'article_content', 'article_abstract', 'article_post_time', 'num_like', 'num_comment', 'article_type', 'article_view','username','head_img','user_id','thumbnail','on_top']).where({ article_header: ['like', `%${keyword}%`]}).order(['on_top DESC','article_id DESC']).page(page, size).select();\n            return _this.success(data);\n          })();\n    }\n    \n    ArticleListAction() {\n        var _this = this;\n        return _asyncToGenerator(function* () {\n            const model = _this.model(\"post_article\");\n            const page = _this.get('page') || 1;\n            const size = _this.get('offset') || 20;\n            const name = _this.get('name') || '';\n            const article_type = _this.get('article_type') || 0;\n            const user_id = _this.getLoginUserId() || 0;\n            var data = [];\n            var item;\n            if(article_type<5&&article_type!=0){\n              data = yield model.field(['article_id', 'article_header', 'article_content', 'article_abstract', 'article_post_time', 'num_like', 'num_comment', 'article_type', 'article_view','username','head_img','user_id','thumbnail','on_top']).where({ article_header: ['like', `%${name}%`] ,article_type:article_type}).order(['on_top DESC','article_id DESC']).page(page, size).select();\n              for(item in data){\n                data[item].string_date = formatDate(data[item].article_post_time,\"yyyy-MM-dd HH:mm:ss\");\n              }\n              \n            }\n            else if(article_type==5){\n                data = yield model.field(['article_id', 'article_header', 'article_content', 'article_abstract', 'article_post_time', 'num_like', 'num_comment', 'article_type', 'article_view','username','head_img','user_id','thumbnail','on_top']).where({ article_header: ['like', `%${name}%`],user_id:user_id}).order(['on_top DESC','article_id DESC']).page(page, size).select();\n                for(item in data){\n                  data[item].string_date = formatDate(data[item].article_post_time,\"yyyy-MM-dd HH:mm:ss\");\n                }\n              }\n              else if(article_type==0){\n                data = yield model.field(['article_id', 'article_header', 'article_content', 'article_abstract', 'article_post_time', 'num_like', 'num_comment', 'article_type', 'article_view','username','head_img','user_id','thumbnail','on_top']).where({ article_header: ['like', `%${name}%`]}).order(['on_top DESC','article_id DESC']).page(page, size).select();\n                for(item in data){\n                  data[item].string_date = formatDate(data[item].article_post_time,\"yyyy-MM-dd HH:mm:ss\");\n                }\n              }\n            \n            return _this.success(data);\n          })();\n    }\n     ArticleLikeAction() {\n        var _this = this;\n        return _asyncToGenerator(function* () {\n            const model = _this.model(\"post_article\");\n            const article_id = _this.get('article_id') || 0;\n            const post_like = _this.get('post_like') || 1;\n            var data = [];\n            // model.transaction(function * (){\n              const ArticleInfo = yield model.where({article_id:article_id}).find();\n              var new_num_like = post_like==0 ? ArticleInfo.num_like+1 : ArticleInfo.num_like-1;\n              if(new_num_like < 0){\n                  new_num_like=0;\n              }\n              data = yield model.where({article_id:article_id}).update({num_like:new_num_like});\n              \n            // });\n            return _this.success(data);\n          })();\n    }\n    ArticleDeleteAction() {\n        var _this = this;\n        this.allowMethods = 'POST';\n        return _asyncToGenerator(function* () {\n            const model = _this.model(\"post_article\");\n            const article_id = _this.post('article_id');\n            const user_id = _this.getLoginUserId();\n            var data = [];\n            // model.transaction(function * (){\n              const model1 = _this.model('comment_article').db(model.db());\n              data = yield model.where({ article_id: article_id,user_id:user_id}).limit(1).delete();\n              data = yield model1.where({article_id: article_id}).delete();\n              var good_pic;\n              const model2 = _this.model('article_gallery').db(model.db());\n              const good_pics = yield model2.field(['img_url']).where({article_id:article_id}).select();\n              yield model2.field(['img_url']).where({article_id:article_id}).delete();\n              for(good_pic in good_pics){\n                //fs.unlink删除文件\n                console.log(good_pics[good_pic]);\n                let temp_arr =  good_pics[good_pic].img_url.toString().split(\"/\");\n                let temp_name = temp_arr.slice(-1);\n                temp_name = think.ROOT_PATH + '/www/' + \"static/upload/article/\"+temp_name;\n                console.log(temp_name);\n                fs.unlink(temp_name,function(error){\n                  if(error){\n                      console.log(error);\n                      return false;\n                  }\n                  console.log('删除文件成功');\n                })\n          \n                }\n                \n              return _this.success(data);\n            // })\n            \n            \n            \n          })();\n    }\n    ArticlePicAction(){\n      var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const articleFile = _this.file('article_pic');\n      if (think.isEmpty(articleFile)) {\n        return _this.fail('保存失败');\n      }\n      const that = _this;\n      const filename = 'static/upload/article/' + think.uuid(32) + '.jpg';\n      const is = fs.createReadStream(articleFile.path);\n      const os = fs.createWriteStream(think.ROOT_PATH + '/www/' + filename);\n      is.pipe(os);\n\n      return that.success({\n        name: 'article_pic',\n        fileUrl: 'https://wjlpt.com/nideshop_api' + filename\n      });\n    })();\n    }\n    PostArticleAction() {\n        this.allowMethods = 'POST';\n        var _this = this;\n        return _asyncToGenerator(function* () {\n          const model = _this.model('post_article');\n          var user_id = _this.getLoginUserId();\n          var value = _this.post();\n          value.article_header = xss(_this.post(\"article_header\"));\n          value.article_abstract = xss(_this.post(\"article_abstract\"));\n          value.article_content = xss(_this.post(\"article_content\"));\n          value.article_post_time = xss(_this.post(\"article_post_time\"));\n          value.article_type = xss(_this.post(\"article_type\"));\n          value.on_top = _this.post(\"on_top\")||0;\n          console.log(value.images_url);\n          var headimg_man = \"https://sparrowoo.top/images/profile/Headimg_MaleIndex.jpeg\";\n          var headimg_woman = \"https://sparrowoo.top/images/profile/Headimg_FeMaleIndex.jpeg\";\n          \n          var userInfo = yield _this.model('user').where({ id: user_id }).find();\n          value.user_id = user_id;\n          value.open_id = userInfo.weixin_openid;\n          value.num_like = 0;\n          value.num_comment = 0;\n          value.article_view = 0;\n          value.username = userInfo.nickname;\n          value.head_img = userInfo.avatar;\n          if (value.article_type == 4) {\n            value.username = userInfo.gender ? \"某男同学\" : \"某女同学\";\n            value.head_img = userInfo.gender ? headimg_man : headimg_woman;\n          }\n          // model.transaction(function * (){\n            const article_id = yield model.add(value);\n            const model1 = _this.model('article_gallery').db(model.db());\n            var each_item;\n            for(each_item in value.images_url){\n              yield model1.add({article_id:article_id,img_url:value.images_url[each_item]});\n            }\n            delete value.open_id;\n            return _this.success(value);\n          // });\n         \n          \n          \n        })();\n      }\n\n  \n  };\n  /**\n   * 时间字符串转换\n   * \n   */\n  function formatDate(date, format) {   \n    if (!date) return;   \n    if (!format) format = \"yyyy-MM-dd\";   \n    switch(typeof date) {   \n        case \"string\":   \n            date = new Date(date.replace(/-/, \"/\"));   \n            break;   \n        case \"number\":   \n            date = new Date(date);   \n            break;   \n    }    \n    if (!date instanceof Date) return;   \n    var dict = {   \n        \"yyyy\": date.getFullYear(),   \n        \"M\": date.getMonth() + 1,   \n        \"d\": date.getDate(),   \n        \"H\": date.getHours(),   \n        \"m\": date.getMinutes(),   \n        \"s\": date.getSeconds(),   \n        \"MM\": (\"\" + (date.getMonth() + 101)).substr(1),   \n        \"dd\": (\"\" + (date.getDate() + 100)).substr(1),   \n        \"HH\": (\"\" + (date.getHours() + 100)).substr(1),   \n        \"mm\": (\"\" + (date.getMinutes() + 100)).substr(1),   \n        \"ss\": (\"\" + (date.getSeconds() + 100)).substr(1)   \n    };       \n    return format.replace(/(yyyy|MM?|dd?|HH?|ss?|mm?)/g, function() {   \n        return dict[arguments[0]];   \n    });                   \n}   \n  //# sourceMappingURL=brand.js.map"
    ]
}