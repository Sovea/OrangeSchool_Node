{
    "version": 3,
    "sources": [
        "../../../src/admin/controller/advert.js"
    ],
    "names": [
        "_asyncToGenerator",
        "fn",
        "gen",
        "apply",
        "arguments",
        "Promise",
        "resolve",
        "reject",
        "step",
        "key",
        "arg",
        "info",
        "value",
        "error",
        "done",
        "then",
        "err",
        "Base",
        "require",
        "fs",
        "module",
        "exports",
        "indexAction",
        "_this",
        "page",
        "get",
        "size",
        "name",
        "model",
        "data",
        "field",
        "where",
        "order",
        "countSelect",
        "success",
        "infoAction",
        "_this2",
        "id",
        "find",
        "storeAction",
        "_this3",
        "isPost",
        "values",
        "post",
        "enabled",
        "update",
        "add",
        "destoryAction",
        "_this4",
        "good_pics",
        "select",
        "limit",
        "delete",
        "good_pic",
        "console",
        "log",
        "temp_arr",
        "image_url",
        "toString",
        "split",
        "temp_name",
        "slice",
        "think",
        "ROOT_PATH",
        "unlink"
    ],
    "mappings": "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",
    "file": "../../../src/admin/controller/advert.js",
    "sourcesContent": [
        "function _asyncToGenerator(fn) {\n  return function () {\n    var gen = fn.apply(this, arguments);return new Promise(function (resolve, reject) {\n      function step(key, arg) {\n        try {\n          var info = gen[key](arg);var value = info.value;\n        } catch (error) {\n          reject(error);return;\n        }if (info.done) {\n          resolve(value);\n        } else {\n          return Promise.resolve(value).then(function (value) {\n            step(\"next\", value);\n          }, function (err) {\n            step(\"throw\", err);\n          });\n        }\n      }return step(\"next\");\n    });\n  };\n}\n\nconst Base = require('./base.js');\nconst fs = require('fs');\nmodule.exports = class extends Base {\n  /**\n   * index action\n   * @return {Promise} []\n   */\n  indexAction() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const page = _this.get('page') || 1;\n      const size = _this.get('size') || 10;\n      const name = _this.get('name') || '';\n\n      const model = _this.model('ad');\n      const data = yield model.field(['id', 'ad_position_id', 'media_type', 'name', 'link', 'image_url', 'content', 'end_time', 'enabled']).where({ name: ['like', `%${name}%`] }).order(['id DESC']).page(page, size).countSelect();\n\n      return _this.success(data);\n    })();\n  }\n\n  infoAction() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      const id = _this2.get('id');\n      const model = _this2.model('ad');\n      const data = yield model.where({ id: id }).find();\n\n      return _this2.success(data);\n    })();\n  }\n\n  storeAction() {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      if (!_this3.isPost) {\n        return false;\n      }\n\n      const values = _this3.post();\n      const id = _this3.post('id');\n\n      const model = _this3.model('ad');\n      values.enabled = values.enabled ? 1 : 0;\n      if (id > 0) {\n        yield model.where({ id: id }).update(values);\n      } else {\n        delete values.id;\n        yield model.add(values);\n      }\n      return _this3.success(values);\n    })();\n  }\n\n  destoryAction() {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      const id = _this4.post('id');\n      const good_pics = yield _this4.model('ad').where({ id: id }).select();\n      yield _this4.model('ad').where({ id: id }).limit(1).delete();\n      // TODO 删除图片\n      var good_pic;\n      for(good_pic in good_pics){\n        //fs.unlink删除文件\n        console.log(good_pics[good_pic]);\n        let temp_arr =  good_pics[good_pic].image_url.toString().split(\"/\");\n        let temp_name = temp_arr.slice(-1);\n        temp_name = think.ROOT_PATH + '/www/' + \"static/upload/advert/\"+temp_name;\n        console.log(temp_name);\n        fs.unlink(temp_name,function(error){\n          if(error){\n              console.log(error);\n              return false;\n          }\n          console.log('删除文件成功');\n        })\n  \n        }\n      return _this4.success();\n    })();\n  }\n\n};\n//# sourceMappingURL=brand.js.map"
    ]
}