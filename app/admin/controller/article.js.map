{
    "version": 3,
    "sources": [
        "../../../src/admin/controller/article.js"
    ],
    "names": [
        "_asyncToGenerator",
        "fn",
        "gen",
        "apply",
        "arguments",
        "Promise",
        "resolve",
        "reject",
        "step",
        "key",
        "arg",
        "info",
        "value",
        "error",
        "done",
        "then",
        "err",
        "Base",
        "require",
        "xss",
        "fs",
        "module",
        "exports",
        "ArticleInfoAction",
        "_this2",
        "id",
        "get",
        "model",
        "data",
        "where",
        "article_id",
        "find",
        "new_article_view",
        "article_view",
        "string_date",
        "formatDate",
        "article_post_time",
        "update",
        "open_id",
        "success",
        "ArticleSearchAction",
        "_this",
        "page",
        "size",
        "keyword",
        "field",
        "article_header",
        "order",
        "select",
        "ArticleListAction",
        "name",
        "article_type",
        "user_id",
        "item",
        "_pk",
        "countSelect",
        "ArticleSetTopAction",
        "post",
        "on_top",
        "ArticleLikeAction",
        "post_like",
        "ArticleInfo",
        "new_num_like",
        "num_like",
        "ArticleDeleteAction",
        "allowMethods",
        "model1",
        "limit",
        "delete",
        "article_pic",
        "article_pics",
        "console",
        "log",
        "temp_arr",
        "img_url",
        "toString",
        "split",
        "temp_name",
        "slice",
        "think",
        "ROOT_PATH",
        "unlink",
        "ArticlePicAction",
        "articleFile",
        "file",
        "isEmpty",
        "fail",
        "that",
        "filename",
        "uuid",
        "is",
        "createReadStream",
        "path",
        "os",
        "createWriteStream",
        "pipe",
        "fileUrl",
        "date",
        "format",
        "Date",
        "replace",
        "dict",
        "getFullYear",
        "getMonth",
        "getDate",
        "getHours",
        "getMinutes",
        "getSeconds",
        "substr"
    ],
    "mappings": "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",
    "file": "../../../src/admin/controller/article.js",
    "sourcesContent": [
        "function _asyncToGenerator(fn) {\n    return function () {\n      var gen = fn.apply(this, arguments);return new Promise(function (resolve, reject) {\n        function step(key, arg) {\n          try {\n            var info = gen[key](arg);var value = info.value;\n          } catch (error) {\n            reject(error);return;\n          }if (info.done) {\n            resolve(value);\n          } else {\n            return Promise.resolve(value).then(function (value) {\n              step(\"next\", value);\n            }, function (err) {\n              step(\"throw\", err);\n            });\n          }\n        }return step(\"next\");\n      });\n    };\n  }\n  \n  const Base = require('./base.js');\n  const xss = require(\"xss\");\n  const fs = require('fs');\n  module.exports = class extends Base {\n    /**\n     * index action\n     * @return {Promise} []\n     */\n    ArticleInfoAction() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        const id = _this2.get('article_id');\n        const model = _this2.model('post_article');\n        var data = yield model.where({ article_id: id }).find();\n        var new_article_view = data.article_view+1;\n        data.string_date = formatDate(data.article_post_time,\"yyyy-MM-dd HH:mm:ss\");\n        yield model.where({ article_id: id }).update({article_view:new_article_view});\n        delete data.open_id;\n        return _this2.success(data);\n      })();\n    }\n    ArticleSearchAction() {\n        var _this = this;\n        return _asyncToGenerator(function* () {\n            const model = _this.model(\"post_article\");\n            const page = _this.get('page') || 1;\n            const size = _this.get('offset') || 20;\n            const keyword = _this.get('keyword') || '';\n            var data = [];\n                data = yield model.field(['article_id', 'article_header', 'article_content', 'article_abstract', 'article_post_time', 'num_like', 'num_comment', 'article_type', 'article_view','username','head_img','user_id','thumbnail']).where({ article_header: ['like', `%${keyword}%`]}).order(['article_id DESC']).page(page, size).select();\n            return _this.success(data);\n          })();\n    }\n    \n    ArticleListAction() {\n        var _this = this;\n        return _asyncToGenerator(function* () {\n            const model = _this.model(\"post_article\");\n            const page = _this.get('page') || 1;\n            const size = _this.get('offset') || 20;\n            const name = _this.get('name') || '';\n            const article_type = _this.get('article_type') || 0;\n            const user_id = 0;\n            \n            var item;\n            // if(article_type<5&&article_type!=0){\n            //   data = yield model.field(['article_id', 'article_header', 'article_content', 'article_abstract', 'article_post_time', 'num_like', 'num_comment', 'article_type', 'article_view','username','head_img','user_id','thumbnail']).where({ article_header: ['like', `%${name}%`] ,article_type:article_type}).order(['article_id DESC']).page(page, size).countSelect();\n            //   for(item in data){\n            //     data[item].string_date = formatDate(data[item].article_post_time,\"yyyy-MM-dd HH:mm:ss\");\n            //   }\n              \n            // }\n            // else if(article_type==5){\n            //     data = yield model.field(['article_id', 'article_header', 'article_content', 'article_abstract', 'article_post_time', 'num_like', 'num_comment', 'article_type', 'article_view','username','head_img','user_id','thumbnail']).where({ article_header: ['like', `%${name}%`],user_id:user_id}).order(['article_id DESC']).page(page, size).countSelect();\n            //     for(item in data){\n            //       data[item].string_date = formatDate(data[item].article_post_time,\"yyyy-MM-dd HH:mm:ss\");\n            //     }\n            //   }\n            //   else if(article_type==0){\n            //     data = yield model.field(['article_id', 'article_header', 'article_content', 'article_abstract', 'article_post_time', 'num_like', 'num_comment', 'article_type', 'article_view','username','head_img','user_id','thumbnail']).where({ article_header: ['like', `%${name}%`]}).order(['article_id DESC']).page(page, size).countSelect();\n            //     for(item in data){\n            //       data[item].string_date = formatDate(data[item].article_post_time,\"yyyy-MM-dd HH:mm:ss\");\n            //     }\n            //   }\n            model._pk = 'article_id';\n            var data = yield model.field(['article_id', 'article_header', 'article_content', 'article_abstract', 'article_post_time', 'num_like', 'num_comment', 'article_type', 'article_view','username','head_img','user_id','thumbnail','on_top']).where({ article_header: ['like', `%${name}%`]}).order(['on_top DESC','article_id DESC']).page(page, size).countSelect();\n                // for(item in data){\n                //   data[item].string_date = formatDate(data[item].article_post_time,\"yyyy-MM-dd HH:mm:ss\");\n                // }\n            return _this.success(data);\n          })();\n    }\n    ArticleSetTopAction(){\n      var _this = this;\n        return _asyncToGenerator(function* () {\n            const model = _this.model(\"post_article\");\n            const article_id = _this.post('article_id') || 0;\n            var data = [];\n            data = yield model.where({article_id:article_id}).update({on_top:1});\n            return _this.success(data);\n          })();\n    }\n    ArticleLikeAction() {\n        var _this = this;\n        return _asyncToGenerator(function* () {\n            const model = _this.model(\"post_article\");\n            const article_id = _this.get('article_id') || 0;\n            const post_like = _this.get('post_like') || 1;\n            var data = [];\n            const ArticleInfo = yield model.where({article_id:article_id}).find();\n            var new_num_like = post_like==0 ? ArticleInfo.num_like+1 : ArticleInfo.num_like-1;\n            if(new_num_like < 0){\n                new_num_like=0;\n            }\n            data = yield model.where({article_id:article_id}).update({num_like:new_num_like});\n            return _this.success(data);\n          })();\n    }\n    ArticleDeleteAction() {\n        var _this = this;\n        this.allowMethods = 'POST';\n        return _asyncToGenerator(function* () {\n            const model = _this.model(\"post_article\");\n            const model1 = _this.model(\"comment_article\");\n            const article_id = _this.post('article_id');\n            // const user_id = _this.getLoginUserId();\n            var data = [];\n            data = yield model.where({ article_id: article_id}).limit(1).delete();\n            yield model1.where({article_id: article_id}).delete();\n            var article_pic;\n            const article_pics = yield _this.model('article_gallery').field(['img_url']).where({article_id:article_id}).select();\n            yield _this.model('article_gallery').field(['img_url']).where({article_id:article_id}).delete();\n            for(article_pic in article_pics){\n              //fs.unlink删除文件\n              console.log(article_pics[article_pic]);\n              let temp_arr =  article_pics[article_pic].img_url.toString().split(\"/\");\n              let temp_name = temp_arr.slice(-1);\n              temp_name = think.ROOT_PATH + '/www/' + \"static/upload/article/\"+temp_name;\n              console.log(temp_name);\n              fs.unlink(temp_name,function(error){\n                if(error){\n                    console.log(error);\n                    return false;\n                }\n                console.log('删除文件成功');\n              })\n        \n              }\n              \n            return _this.success(data);\n          })();\n    }\n    ArticlePicAction(){\n      var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const articleFile = _this.file('article_pic');\n      if (think.isEmpty(articleFile)) {\n        return _this.fail('保存失败');\n      }\n      const that = _this;\n      const filename = 'static/upload/article/' + think.uuid(32) + '.jpg';\n      const is = fs.createReadStream(articleFile.path);\n      const os = fs.createWriteStream(think.ROOT_PATH + '/www/' + filename);\n      is.pipe(os);\n\n      return that.success({\n        name: 'article_pic',\n        fileUrl: 'https://wjlpt.com/nideshop_api' + filename\n      });\n    })();\n    }\n    // PostArticleAction() {\n    //     this.allowMethods = 'POST';\n    //     var _this = this;\n    //     return _asyncToGenerator(function* () {\n\n    //       // var user_id = _this.getLoginUserId();\n    //       var value = _this.post();\n    //       value.article_header = xss(_this.post(\"article_header\"));\n    //       value.article_abstract = xss(_this.post(\"article_abstract\"));\n    //       value.article_content = xss(_this.post(\"article_content\"));\n    //       value.article_post_time = xss(_this.post(\"article_post_time\"));\n    //       value.article_type = xss(_this.post(\"article_type\"));\n    //       console.log(value.images_url);\n    //       var headimg_man = \"https://sparrowoo.top/images/profile/Headimg_MaleIndex.jpeg\";\n    //       var headimg_woman = \"https://sparrowoo.top/images/profile/Headimg_FeMaleIndex.jpeg\";\n    //       var userInfo = yield _this.model('user').where({ id: user_id }).find();\n    //       value.user_id = user_id;\n    //       value.open_id = userInfo.weixin_openid;\n    //       value.num_like = 0;\n    //       value.num_comment = 0;\n    //       value.article_view = 0;\n    //       value.username = userInfo.nickname;\n    //       value.head_img = userInfo.avatar;\n    //       if (value.article_type == 4) {\n    //         value.username = userInfo.gender ? \"某男同学\" : \"某女同学\";\n    //         value.head_img = userInfo.gender ? headimg_man : headimg_woman;\n    //       }\n    //       const article_id = yield _this.model('post_article').add(value);\n    //       var each_item;\n    //       for(each_item in value.images_url){\n    //         yield _this.model('article_gallery').add({article_id:article_id,img_url:value.images_url[each_item]});\n    //       }\n    //       delete value.open_id;\n    //       return _this.success(value);\n    //     })();\n    //   }\n\n  \n  };\n  /**\n   * 时间字符串转换\n   * \n   */\n  function formatDate(date, format) {   \n    if (!date) return;   \n    if (!format) format = \"yyyy-MM-dd\";   \n    switch(typeof date) {   \n        case \"string\":   \n            date = new Date(date.replace(/-/, \"/\"));   \n            break;   \n        case \"number\":   \n            date = new Date(date);   \n            break;   \n    }    \n    if (!date instanceof Date) return;   \n    var dict = {   \n        \"yyyy\": date.getFullYear(),   \n        \"M\": date.getMonth() + 1,   \n        \"d\": date.getDate(),   \n        \"H\": date.getHours(),   \n        \"m\": date.getMinutes(),   \n        \"s\": date.getSeconds(),   \n        \"MM\": (\"\" + (date.getMonth() + 101)).substr(1),   \n        \"dd\": (\"\" + (date.getDate() + 100)).substr(1),   \n        \"HH\": (\"\" + (date.getHours() + 100)).substr(1),   \n        \"mm\": (\"\" + (date.getMinutes() + 100)).substr(1),   \n        \"ss\": (\"\" + (date.getSeconds() + 100)).substr(1)   \n    };       \n    return format.replace(/(yyyy|MM?|dd?|HH?|ss?|mm?)/g, function() {   \n        return dict[arguments[0]];   \n    });                   \n}   \n  //# sourceMappingURL=brand.js.map"
    ]
}