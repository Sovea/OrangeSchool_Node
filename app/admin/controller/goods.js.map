{
    "version": 3,
    "sources": [
        "../../../src/admin/controller/goods.js"
    ],
    "names": [
        "_asyncToGenerator",
        "fn",
        "gen",
        "apply",
        "arguments",
        "Promise",
        "resolve",
        "reject",
        "step",
        "key",
        "arg",
        "info",
        "value",
        "error",
        "done",
        "then",
        "err",
        "Base",
        "require",
        "fs",
        "module",
        "exports",
        "indexAction",
        "_this",
        "page",
        "get",
        "size",
        "name",
        "model",
        "data",
        "where",
        "order",
        "countSelect",
        "success",
        "usergoodsAction",
        "promotion_desc",
        "infoAction",
        "_this2",
        "id",
        "find",
        "storeAction",
        "_this3",
        "isPost",
        "values",
        "post",
        "model2",
        "img_url",
        "img",
        "console",
        "log",
        "is_on_sale",
        "is_new",
        "is_hot",
        "temp_data",
        "goods_id",
        "update",
        "good_status",
        "add",
        "goods_number",
        "retail_price",
        "good_id",
        "max",
        "goods_sn",
        "primary_product_id",
        "goods_specification_ids",
        "img_desc",
        "sort_order",
        "destoryAction",
        "_this4",
        "limit",
        "delete",
        "good_pic",
        "good_pics",
        "field",
        "select",
        "temp_arr",
        "toString",
        "split",
        "temp_name",
        "slice",
        "think",
        "ROOT_PATH",
        "unlink"
    ],
    "mappings": "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",
    "file": "../../../src/admin/controller/goods.js",
    "sourcesContent": [
        "function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step(\"next\", value); }, function (err) { step(\"throw\", err); }); } } return step(\"next\"); }); }; }\r\n\r\nconst Base = require('./base.js');\r\nconst fs = require('fs');\r\nmodule.exports = class extends Base {\r\n  /**\r\n   * index action\r\n   * @return {Promise} []\r\n   */\r\n  indexAction() {\r\n    var _this = this;\r\n\r\n    return _asyncToGenerator(function* () {\r\n      const page = _this.get('page') || 1;\r\n      const size = _this.get('size') || 10;\r\n      const name = _this.get('name') || '';\r\n\r\n      const model = _this.model('goods');\r\n      const data = yield model.where({ name: ['like', `%${name}%`] }).order(['id DESC']).page(page, size).countSelect();\r\n\r\n      return _this.success(data);\r\n    })();\r\n  }\r\n  usergoodsAction(){\r\n    var _this = this;\r\n\r\n    return _asyncToGenerator(function* () {\r\n      const page = _this.get('page') || 1;\r\n      const size = _this.get('size') || 10;\r\n      const name = _this.get('name') || '';\r\n\r\n      const model = _this.model('goods');\r\n      const data = yield model.where({ name: ['like', `%${name}%`],promotion_desc:[\"=\",\"二手交易\",\"or\",\"以物换物\"]}).order(['id DESC']).page(page, size).countSelect();\r\n\r\n      return _this.success(data);\r\n    })();\r\n  }\r\n  infoAction() {\r\n    var _this2 = this;\r\n\r\n    return _asyncToGenerator(function* () {\r\n      const id = _this2.get('id');\r\n      const model = _this2.model('goods');\r\n      const data = yield model.where({ id: id }).find();\r\n\r\n      return _this2.success(data);\r\n    })();\r\n  }\r\n  storeAction() {\r\n    var _this3 = this;\r\n\r\n    return _asyncToGenerator(function* () {\r\n      if (!_this3.isPost) {\r\n        return false;\r\n      }\r\n\r\n      const values = _this3.post();\r\n      const id = _this3.post('id');\r\n      const model = _this3.model('goods');\r\n      const model2 = _this3.model('goods_gallery');\r\n      const img_url = _this3.post('img_url');\r\n      var img;\r\n      delete values.img_url;\r\n      console.log(img_url);\r\n      values.is_on_sale = values.is_on_sale ? 1 : 0;\r\n      values.is_new = values.is_new ? 1 : 0;\r\n      values.is_hot = values.is_hot ? 1 : 0;\r\n      if (id > 0) {\r\n        var temp_data = yield _this3.model('user_goods').where({ goods_id: id }).find();\r\n        if(temp_data.id){\r\n          yield _this3.model('user_goods').where({ id: temp_data.id }).update({good_status:values.is_on_sale});\r\n        }\r\n        yield model.where({ id: id }).update(values);\r\n        yield _this3.model('product').add({goods_number:values.goods_number,retail_price:values.retail_price});\r\n      } else {\r\n        delete values.id;\r\n        yield model.add(values);\r\n        var good_id = yield model.max('id');\r\n        values.id = good_id;\r\n        yield model.where({ id: good_id }).update({goods_sn:good_id,primary_product_id:good_id});\r\n        yield _this3.model('product').add({goods_id:good_id,goods_specification_ids:\"\",goods_sn:good_id,goods_number:values.goods_number,retail_price:values.retail_price});\r\n        for(img in img_url){\r\n          console.log(img);\r\n          yield model2.add({goods_id:good_id,img_url:img_url[img],img_desc:\"\",sort_order:values.sort_order});\r\n        }\r\n        \r\n      }\r\n      return _this3.success(values);\r\n    })();\r\n  }\r\n\r\n  destoryAction() {\r\n    var _this4 = this;\r\n    return _asyncToGenerator(function* () {\r\n      const id = _this4.post('id');\r\n      var value = yield _this4.model('goods').where({ id: id }).limit(1).find();\r\n      if(value.promotion_desc==\"二手交易\"||value.promotion_desc==\"以物换物\"){\r\n        yield _this4.model('user_goods').where({ goods_id: id }).limit(1).delete();\r\n      }\r\n      yield _this4.model('goods').where({ id: id }).limit(1).delete();\r\n      var good_pic;\r\n      const good_pics = yield _this4.model('goods_gallery').field(['img_url']).where({ goods_id: id }).select();\r\n      for(good_pic in good_pics){\r\n      //fs.unlink删除文件\r\n      console.log(good_pics[good_pic]);\r\n      let temp_arr =  good_pics[good_pic].img_url.toString().split(\"/\");\r\n      let temp_name = temp_arr.slice(-1);\r\n      temp_name = think.ROOT_PATH + '/www/' + \"static/upload/good/\"+temp_name;\r\n      console.log(temp_name);\r\n      fs.unlink(temp_name,function(error){\r\n        if(error){\r\n            console.log(error);\r\n            return false;\r\n        }\r\n        console.log('删除文件成功');\r\n      })\r\n\r\n      }\r\n      yield _this4.model('goods_gallery').where({ goods_id: id }).delete();\r\n      // TODO 删除图片\r\n      return _this4.success();\r\n    })();\r\n  }\r\n};\r\n//# sourceMappingURL=goods.js.map"
    ]
}