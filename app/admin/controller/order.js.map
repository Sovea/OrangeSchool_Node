{
    "version": 3,
    "sources": [
        "../../../src/admin/controller/order.js"
    ],
    "names": [
        "_asyncToGenerator",
        "fn",
        "gen",
        "apply",
        "arguments",
        "Promise",
        "resolve",
        "reject",
        "step",
        "key",
        "arg",
        "info",
        "value",
        "error",
        "done",
        "then",
        "err",
        "Base",
        "require",
        "module",
        "exports",
        "indexAction",
        "_this",
        "page",
        "get",
        "size",
        "orderSn",
        "consignee",
        "model",
        "data",
        "where",
        "order_sn",
        "order",
        "countSelect",
        "newList",
        "item",
        "order_status_text",
        "getOrderStatusText",
        "id",
        "push",
        "success",
        "infoAction",
        "_this2",
        "find",
        "storeAction",
        "_this3",
        "isPost",
        "values",
        "post",
        "is_show",
        "is_new",
        "update",
        "add",
        "destoryAction",
        "_this4",
        "limit",
        "delete",
        "order_id"
    ],
    "mappings": "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",
    "file": "../../../src/admin/controller/order.js",
    "sourcesContent": [
        "function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step(\"next\", value); }, function (err) { step(\"throw\", err); }); } } return step(\"next\"); }); }; }\r\n\r\nconst Base = require('./base.js');\r\n\r\nmodule.exports = class extends Base {\r\n  /**\r\n   * index action\r\n   * @return {Promise} []\r\n   */\r\n  indexAction() {\r\n    var _this = this;\r\n\r\n    return _asyncToGenerator(function* () {\r\n      const page = _this.get('page') || 1;\r\n      const size = _this.get('size') || 10;\r\n      const orderSn = _this.get('orderSn') || '';\r\n      const consignee = _this.get('consignee') || '';\r\n\r\n      const model = _this.model('order');\r\n      const data = yield model.where({ order_sn: ['like', `%${orderSn}%`], consignee: ['like', `%${consignee}%`] }).order(['id DESC']).page(page, size).countSelect();\r\n      const newList = [];\r\n      for (const item of data.data) {\r\n        item.order_status_text = yield _this.model('order').getOrderStatusText(item.id);\r\n        newList.push(item);\r\n      }\r\n      data.data = newList;\r\n      return _this.success(data);\r\n    })();\r\n  }\r\n\r\n  infoAction() {\r\n    var _this2 = this;\r\n\r\n    return _asyncToGenerator(function* () {\r\n      const id = _this2.get('id');\r\n      const model = _this2.model('order');\r\n      const data = yield model.where({ id: id }).find();\r\n\r\n      return _this2.success(data);\r\n    })();\r\n  }\r\n\r\n  storeAction() {\r\n    var _this3 = this;\r\n\r\n    return _asyncToGenerator(function* () {\r\n      if (!_this3.isPost) {\r\n        return false;\r\n      }\r\n\r\n      const values = _this3.post();\r\n      const id = _this3.post('id');\r\n\r\n      const model = _this3.model('order');\r\n      values.is_show = values.is_show ? 1 : 0;\r\n      values.is_new = values.is_new ? 1 : 0;\r\n      if (id > 0) {\r\n        yield model.where({ id: id }).update(values);\r\n      } else {\r\n        delete values.id;\r\n        yield model.add(values);\r\n      }\r\n      return _this3.success(values);\r\n    })();\r\n  }\r\n\r\n  destoryAction() {\r\n    var _this4 = this;\r\n\r\n    return _asyncToGenerator(function* () {\r\n      const id = _this4.post('id');\r\n      yield _this4.model('order').where({ id: id }).limit(1).delete();\r\n\r\n      // 删除订单商品\r\n      yield _this4.model('order_goods').where({ order_id: id }).delete();\r\n\r\n      // TODO 事务，验证订单是否可删除（只有失效的订单才可以删除）\r\n\r\n      return _this4.success();\r\n    })();\r\n  }\r\n};\r\n//# sourceMappingURL=order.js.map"
    ]
}